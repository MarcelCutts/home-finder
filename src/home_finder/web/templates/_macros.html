{# Reusable UI macros for property templates #}

{%- macro quality_badge(value, green_values, amber_values, red_values) -%}
<span class="badge {% if value in green_values %}badge-green{% elif value in amber_values %}badge-amber{% elif value in red_values %}badge-red{% else %}badge-neutral{% endif %}">{{ caller() }}</span>
{%- endmacro -%}

{%- macro quality_item_class(value, excellent_values, fair_values, poor_values) -%}
quality-item quality-item{% if value in excellent_values %}-excellent{% elif value in fair_values %}-fair{% elif value in poor_values %}-poor{% else %}-neutral{% endif %}
{%- endmacro -%}

{%- macro fit_tier_label(score) -%}
{% if score >= 80 %}Great Fit{% elif score >= 60 %}Good Fit{% elif score >= 40 %}Okay{% else %}Poor Fit{% endif %}
{%- endmacro -%}

{%- macro fit_tier_class(score) -%}
{% if score >= 80 %}fit-tier-great{% elif score >= 60 %}fit-tier-good{% elif score >= 40 %}fit-tier-okay{% else %}fit-tier-poor{% endif %}
{%- endmacro -%}

{%- macro fit_badge(score, breakdown=None) -%}
{% if score is not none %}
<details class="fit-popover-wrap">
    <summary class="fit-badge {% if score >= 80 %}fit-green{% elif score >= 60 %}fit-accent{% elif score >= 40 %}fit-amber{% else %}fit-dim{% endif %}" title="Marcel Fit Score: {{ score }}" onclick="event.stopPropagation();">{{ score }}</summary>
    <div class="fit-popover" onclick="event.stopPropagation();">
        <div class="fit-popover-title">Marcel Fit <span class="fit-popover-score">{{ score }}</span></div>
        <div class="fit-popover-tier {{ fit_tier_class(score) }}">{{ fit_tier_label(score) }}</div>
        {% if breakdown %}
        {% for dim in breakdown %}
        <div class="fit-dim-row{% if dim.confidence is defined and dim.confidence < 0.5 %} fit-dim-low-conf{% endif %}">
            <span class="fit-dim-label">{{ dim.label }}</span>
            <div class="fit-dim-track"><div class="fit-dim-fill {% if dim.score >= 70 %}fit-dim-green{% elif dim.score >= 40 %}fit-dim-accent{% else %}fit-dim-low{% endif %}" style="width: {{ dim.score }}%"></div></div>
            <span class="fit-dim-score">{{ dim.score }}</span>
            {% if dim.confidence is defined and dim.confidence < 0.5 %}<span class="fit-dim-conf-hint" title="Limited data for this dimension">?</span>{% endif %}
        </div>
        {% endfor %}
        {% endif %}
    </div>
</details>
{% endif %}
{%- endmacro -%}

{%- macro lifestyle_icons(icons) -%}
{% if icons %}
<div class="card-lifestyle">
    <span class="lifestyle-icon" data-state="{{ icons.workspace.state }}" title="{{ icons.workspace.tooltip }}"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="2" y="3" width="12" height="8" rx="1" stroke="currentColor" stroke-width="1.5"/><line x1="8" y1="11" x2="8" y2="14" stroke="currentColor" stroke-width="1.5"/><line x1="5" y1="14" x2="11" y2="14" stroke="currentColor" stroke-width="1.5"/></svg></span>
    <span class="lifestyle-icon" data-state="{{ icons.hosting.state }}" title="{{ icons.hosting.tooltip }}"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><circle cx="5.5" cy="4.5" r="2" stroke="currentColor" stroke-width="1.3"/><path d="M1.5 13c0-2.2 1.8-4 4-4s4 1.8 4 4" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/><circle cx="11.5" cy="5" r="1.5" stroke="currentColor" stroke-width="1.3"/><path d="M14.5 13a3 3 0 0 0-3-3" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/></svg></span>
    <span class="lifestyle-icon" data-state="{{ icons.kitchen.state }}" title="{{ icons.kitchen.tooltip }}"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><circle cx="6.5" cy="9" r="4" stroke="currentColor" stroke-width="1.3"/><line x1="10" y1="6.5" x2="14.5" y2="2.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg></span>
    <span class="lifestyle-icon" data-state="{{ icons.vibe.state }}" title="{{ icons.vibe.tooltip }}"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M8 1.5L9.5 5.5L13.5 6L10.5 9L11.5 13.5L8 11.5L4.5 13.5L5.5 9L2.5 6L6.5 5.5L8 1.5Z" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
    <span class="lifestyle-icon" data-state="{{ icons.space.state }}" title="{{ icons.space.tooltip }}"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><polyline points="10,2 14,2 14,6" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/><polyline points="6,14 2,14 2,10" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"/><line x1="14" y1="2" x2="9.5" y2="6.5" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/><line x1="2" y1="14" x2="6.5" y2="9.5" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"/></svg></span>
</div>
{% endif %}
{%- endmacro -%}

{%- macro commute_pill(minutes, transport_mode=None) -%}
{% if minutes is not none and minutes %}
{% if minutes <= 15 %}
<span class="commute-pill commute-green">{{ minutes }} min{% if transport_mode == "cycling" %} &#128692;{% elif transport_mode == "public_transport" %} &#128647;{% endif %}</span>
{% elif minutes <= 30 %}
<span class="commute-pill commute-indigo">{{ minutes }} min{% if transport_mode == "cycling" %} &#128692;{% elif transport_mode == "public_transport" %} &#128647;{% endif %}</span>
{% elif minutes <= 45 %}
<span class="commute-pill commute-amber">{{ minutes }} min{% if transport_mode == "cycling" %} &#128692;{% elif transport_mode == "public_transport" %} &#128647;{% endif %}</span>
{% else %}
<span class="commute-pill commute-red">{{ minutes }} min{% if transport_mode == "cycling" %} &#128692;{% elif transport_mode == "public_transport" %} &#128647;{% endif %}</span>
{% endif %}
{% endif %}
{%- endmacro -%}
